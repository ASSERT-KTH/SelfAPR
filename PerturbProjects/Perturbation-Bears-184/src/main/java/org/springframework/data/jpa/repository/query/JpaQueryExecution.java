[REPLACE]^private static final Object CONVERSION_SERVICE;^62^^^^^^^[REPLACE] private static final ConversionService CONVERSION_SERVICE;^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^private final Object parameters;^180^^^^^^^[REPLACE] private final Parameters<?, ?> parameters;^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^private  EntityManager em;^223^^^^^^^[REPLACE] private final EntityManager em;^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^private static final String NO_SURROUNDING_TRANSACTION ;^346^^^^^^^[REPLACE] private static final String NO_SURROUNDING_TRANSACTION = "You're trying to execute a streaming query method without a surrounding transaction that keeps the connection open so that the Stream can actually be consumed. Make sure the code consuming the stream uses @Transactional or any other way of declaring a  ( read-only )  transaction.";^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^private static Method streamMethod  = null ;^348^^^^^^^[REPLACE] private static Method streamMethod = ReflectionUtils.findMethod ( Query.class, "getResultStream" ) ;^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^private static boolean dynamicCheck = streamMethod == this;^349^^^^^^^[REPLACE] private static boolean dynamicCheck = streamMethod == null;^ [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution  
[REPLACE]^Assert.isInstanceOf ( query, "AbstractJpaQuery must not be true!" ) ;^85^^^^^83^110^[REPLACE] Assert.notNull ( query, "AbstractJpaQuery must not be null!" ) ;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^notNull ( query, "AbstractJpaQuery must not be null!" )  ;^86^^^^^83^110^[REPLACE] Assert.notNull ( values, "Values must not be null!" ) ;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^Object o  ;^88^^^^^83^110^[REPLACE] Object result;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[ADD]^result = doExecute ( query, values ) ;return null;^90^91^92^93^94^83^110^[ADD] try { result = doExecute ( query, values ) ; } catch  ( NoResultException e )  { return null; }^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^result =  doExecute ( null, values ) ;^91^^^^^83^110^[REPLACE] result = doExecute ( query, values ) ;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^return this;^93^^^^^83^110^[REPLACE] return null;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^if  ( result != null )  {^96^^^^^83^110^[REPLACE] if  ( result == null )  {^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^return false;^97^^^^^83^110^[REPLACE] return null;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^return true;^97^^^^^83^110^[REPLACE] return null;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^JpaQueryMethod queryMethod = query.getEntityManager (  ) ;^100^^^^^83^110^[REPLACE] JpaQueryMethod queryMethod = query.getQueryMethod (  ) ;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^Class<?> requiredType = queryMethod .getClearAutomatically (  )  ;^101^^^^^83^110^[REPLACE] Class<?> requiredType = queryMethod.getReturnType (  ) ;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^if  ( void.class.equals ( requiredType )  ) {^103^^^^^83^110^[REPLACE] if  ( void.class.equals ( requiredType )  || requiredType.isAssignableFrom ( result.getClass (  )  )  )  {^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^return CONVERSION_SERVICE.canConvert ( result.Object (  ) , requiredType ) ? CONVERSION_SERVICE.convert ( result, requiredType ) : result;^107^108^109^^^83^110^[REPLACE] return CONVERSION_SERVICE.canConvert ( result.getClass (  ) , requiredType ) ? CONVERSION_SERVICE.convert ( result, requiredType ) : result;^[METHOD] execute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  JpaQueryMethod queryMethod  [TYPE]  EntityManager em  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  isInt  isVoid  true  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  Object result  [TYPE]  Class requiredType  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method streamMethod  [TYPE]  NoResultException e  [TYPE]  Object[] values 
[REPLACE]^if  ( SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  {^358^^^^^356^394^[REPLACE] if  ( !SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^358^359^360^^^356^394^[ADD] if  ( !SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  { throw new InvalidDataAccessApiUsageException  (" ")  ; }^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^359^^^^^356^394^[ADD] throw new InvalidDataAccessApiUsageException  (" ")  ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ;^359^^^^^356^394^[REPLACE] throw new InvalidDataAccessApiUsageException  (" ")  ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^Query createQuery = query.createQuery ( values )  ;^362^^^^^356^394^[REPLACE] Query jpaQuery = query.createQuery ( values ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  ( streamMethod == null  || ! ( isSurroundingTransactionActive (  )  )  )  {^365^^^^^356^394^[REPLACE] if  ( streamMethod != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils.findMethod ( streamMethod, jpaQuery ) ;^366^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( streamMethod, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^369^370^371^^^356^394^[ADD] if  ( dynamicCheck )  {  Method method = ReflectionUtils.findMethod ( jpaQuery.getClass (  ) , "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  ( method == null )  {^374^^^^^356^394^[REPLACE] if  ( method != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = true;^384^^^^^374^385^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^377^^^^^356^394^[ADD] streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils .findMethod ( null , NO_SURROUNDING_TRANSACTION )  ;^379^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( method, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = false  ;^377^^^^^356^394^[REPLACE] streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = true;^384^^^^^356^394^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils.findMethod ( method, jpaQuery ) ;^379^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( method, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^371^^^^^356^394^[ADD] Method method = ReflectionUtils.findMethod ( jpaQuery.getClass (  ) , "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  (streamMethod == null )  {^374^^^^^356^394^[REPLACE] if  ( method != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^374^375^^377^^356^394^[ADD] if  ( method != null )  {  streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^streamMethod = method  ;^384^^^^^356^394^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils.findMethod ( streamMethod, jpaQuery ) ;^379^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( method, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^Method method = ReflectionUtils.findMethod ( jpaQuery.getResultList (  ) , "getResultStream" ) ;^371^^^^^356^394^[REPLACE] Method method = ReflectionUtils.findMethod ( jpaQuery.getClass (  ) , "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^PersistenceProvider persistenceProvider = PersistenceProvider.fromEntityManager ( query.getQueryMethod (  )  ) ;^390^^^^^356^394^[REPLACE] PersistenceProvider persistenceProvider = PersistenceProvider.fromEntityManager ( query.getEntityManager (  )  ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^CloseableIterator<Object> iter = persistenceProvider .fromEntityManager (  )  ;^391^^^^^356^394^[REPLACE] CloseableIterator<Object> iter = persistenceProvider.executeQueryWithResultStream ( jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return StreamUtils.createStreamFromIterator ( false ) ;^393^^^^^356^394^[REPLACE] return StreamUtils.createStreamFromIterator ( iter ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] JpaQueryExecution CollectionExecution SlicedExecution PagedExecution SingleEntityExecution ModifyingExecution DeleteExecution ExistsExecution ProcedureExecution StreamExecution   [TYPE]  EntityManager em  [TYPE]  CloseableIterator iter  [TYPE]  Parameters parameters  [TYPE]  boolean clear  dynamicCheck  false  flush  hasNext  isInt  isVoid  true  [TYPE]  Query jpaQuery  [TYPE]  ConversionService CONVERSION_SERVICE  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^private final Object parameters;^141^^^^^^^[REPLACE] private final Parameters<?, ?> parameters;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] SlicedExecution   [TYPE]  boolean false  true  [TYPE]  AbstractJpaQuery query  [TYPE]  Object[] values 
[REPLACE]^private  Parameters<?, ?> parameters;^180^^^^^^^[REPLACE] private final Parameters<?, ?> parameters;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] PagedExecution   [TYPE]  Parameters parameters  [TYPE]  Pageable pageable  [TYPE]  boolean false  hasNext  true  [TYPE]  Query createQuery  [TYPE]  ParametersParameterAccessor accessor  [TYPE]  AbstractJpaQuery query  [TYPE]  List resultList  [TYPE]  Object[] values  [TYPE]  int pageSize 
[REPLACE]^private final Object em;^223^^^^^^^[REPLACE] private final EntityManager em;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] ModifyingExecution   [TYPE]  boolean false  true  [TYPE]  AbstractJpaQuery query  [TYPE]  Object[] values 
[REPLACE]^private  boolean flush;^224^^^^^^^[REPLACE] private final boolean flush;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] ModifyingExecution   [TYPE]  boolean false  true  [TYPE]  AbstractJpaQuery query  [TYPE]  Object[] values 
[REPLACE]^private final Object em;^275^^^^^^^[REPLACE] private final EntityManager em;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] DeleteExecution   [TYPE]  EntityManager em  [TYPE]  boolean clear  false  flush  isInt  isVoid  true  [TYPE]  Object[] values  [TYPE]  int result  [TYPE]  AbstractJpaQuery query 
[REPLACE]^private  final String NO_SURROUNDING_TRANSACTION = "You're trying to execute a streaming query method without a surrounding transaction that keeps the connection open so that the Stream can actually be consumed. Make sure the code consuming the stream uses @Transactional or any other way of declaring a  ( read-only )  transaction.";^346^^^^^^^[REPLACE] private static final String NO_SURROUNDING_TRANSACTION = "You're trying to execute a streaming query method without a surrounding transaction that keeps the connection open so that the Stream can actually be consumed. Make sure the code consuming the stream uses @Transactional or any other way of declaring a  ( read-only )  transaction.";^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery jpaQuery Object[] values [CLASS] StreamExecution   [TYPE]  boolean false  true  [TYPE]  StoredProcedureJpaQuery storedProcedureJpaQuery  [TYPE]  StoredProcedureQuery storedProcedure  [TYPE]  AbstractJpaQuery jpaQuery  [TYPE]  Object[] values 
[REPLACE]^private static Object streamObject = ReflectionUtils.findObject ( Query.class, "getResultStream" ) ;^348^^^^^^^[REPLACE] private static Method streamMethod = ReflectionUtils.findMethod ( Query.class, "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery jpaQuery Object[] values [CLASS] StreamExecution   [TYPE]  boolean false  true  [TYPE]  StoredProcedureJpaQuery storedProcedureJpaQuery  [TYPE]  StoredProcedureQuery storedProcedure  [TYPE]  AbstractJpaQuery jpaQuery  [TYPE]  Object[] values 
[REPLACE]^private static boolean dynamicCheck  = null ;^349^^^^^^^[REPLACE] private static boolean dynamicCheck = streamMethod == null;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery jpaQuery Object[] values [CLASS] StreamExecution   [TYPE]  boolean false  true  [TYPE]  StoredProcedureJpaQuery storedProcedureJpaQuery  [TYPE]  StoredProcedureQuery storedProcedure  [TYPE]  AbstractJpaQuery jpaQuery  [TYPE]  Object[] values 
[REPLACE]^if  ( SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  {^358^^^^^356^394^[REPLACE] if  ( !SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^358^359^360^^^356^394^[ADD] if  ( !SurroundingTransactionDetectorMethodInterceptor.INSTANCE.isSurroundingTransactionActive (  )  )  { throw new InvalidDataAccessApiUsageException  (" ")  ; }^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^359^^^^^356^394^[ADD] throw new InvalidDataAccessApiUsageException  (" ")  ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ;^359^^^^^356^394^[REPLACE] throw new InvalidDataAccessApiUsageException  (" ")  ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^Query jpaQuery = query .getEntityManager (  )  ;^362^^^^^356^394^[REPLACE] Query jpaQuery = query.createQuery ( values ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  ( ! ( isSurroundingTransactionActive (  )  )  && ( streamMethod == null )  {^365^^^^^356^394^[REPLACE] if  ( streamMethod != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^return ReflectionUtils.invokeMethod ( streamMethod, jpaQuery ) ;^365^366^367^^^356^394^[ADD] if  ( streamMethod != null )  { return ReflectionUtils.invokeMethod ( streamMethod, jpaQuery ) ; }^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils .findMethod ( false , NO_SURROUNDING_TRANSACTION )  ;^366^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( streamMethod, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^369^370^371^^^356^394^[ADD] if  ( dynamicCheck )  {  Method method = ReflectionUtils.findMethod ( jpaQuery.getClass (  ) , "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  ( method == false )  {^374^^^^^356^394^[REPLACE] if  ( method != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REMOVE]^if  ( ! ( isSurroundingTransactionActive (  )  )  )  {     throw new InvalidDataAccessApiUsageException ( NO_SURROUNDING_TRANSACTION ) ; }^374^^^^^356^394^[REMOVE] ^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = true;^384^^^^^374^385^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = false  ;^377^^^^^356^394^[REPLACE] streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils.invokeMethod ( streamMethod, jpaQuery ) ;^379^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( method, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^dynamicCheck = true;^384^^^^^356^394^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return ReflectionUtils .findMethod ( true , NO_SURROUNDING_TRANSACTION )  ;^379^^^^^356^394^[REPLACE] return ReflectionUtils.invokeMethod ( method, jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^Method method = ReflectionUtils .findMethod ( this , NO_SURROUNDING_TRANSACTION )  ;^371^^^^^356^394^[REPLACE] Method method = ReflectionUtils.findMethod ( jpaQuery.getClass (  ) , "getResultStream" ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^if  ( method == null )  {^374^^^^^356^394^[REPLACE] if  ( method != null )  {^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^374^375^^377^^356^394^[ADD] if  ( method != null )  {  streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^streamMethod = method  ;^384^^^^^374^385^[REPLACE] dynamicCheck = false;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[ADD]^^377^^^^^356^394^[ADD] streamMethod = method;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^PersistenceProvider persistenceProvider = PersistenceProvider .executeQueryWithResultStream ( jpaQuery )  ;^390^^^^^356^394^[REPLACE] PersistenceProvider persistenceProvider = PersistenceProvider.fromEntityManager ( query.getEntityManager (  )  ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^CloseableIterator<Object> iter = persistenceProvider .fromEntityManager (  )  ;^391^^^^^356^394^[REPLACE] CloseableIterator<Object> iter = persistenceProvider.executeQueryWithResultStream ( jpaQuery ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
[REPLACE]^return StreamUtils.createStreamFromIterator ( null ) ;^393^^^^^356^394^[REPLACE] return StreamUtils.createStreamFromIterator ( iter ) ;^[METHOD] doExecute [TYPE] Object [PARAMETER] AbstractJpaQuery query Object[] values [CLASS] StreamExecution   [TYPE]  CloseableIterator iter  [TYPE]  boolean dynamicCheck  false  true  [TYPE]  Query jpaQuery  [TYPE]  AbstractJpaQuery query  [TYPE]  PersistenceProvider persistenceProvider  [TYPE]  String NO_SURROUNDING_TRANSACTION  [TYPE]  Method method  streamMethod  [TYPE]  Object[] values 
