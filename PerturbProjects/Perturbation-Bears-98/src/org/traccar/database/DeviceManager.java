[REPLACE]^public static final long DEFAULT_REFRESH_DELAY ;^40^^^^^^^[REPLACE] public static final long DEFAULT_REFRESH_DELAY = 300;^ [CLASS] DeviceManager  
[REPLACE]^private  Config config;^42^^^^^^^[REPLACE] private final Config config;^ [CLASS] DeviceManager  
[REPLACE]^private  DataManager dataManager;^43^^^^^^^[REPLACE] private final DataManager dataManager;^ [CLASS] DeviceManager  
[REPLACE]^private  long dataRefreshDelay;^44^^^^^^^[REPLACE] private final long dataRefreshDelay;^ [CLASS] DeviceManager  
[REPLACE]^private Object devicesLastUpdate = new Object (  ) ;^49^^^^^^^[REPLACE] private AtomicLong devicesLastUpdate = new AtomicLong (  ) ;^ [CLASS] DeviceManager  
[REPLACE]^private Map<Long, Collection groupsById;^51^^^^^^^[REPLACE] private Map<Long, Group> groupsById;^ [CLASS] DeviceManager  
[REPLACE]^private Position groupsLastUpdate = new Position (  ) ;^52^^^^^^^[REPLACE] private AtomicLong groupsLastUpdate = new AtomicLong (  ) ;^ [CLASS] DeviceManager  
[REPLACE]^private  Map<Long, Position> positions = new ConcurrentHashMap<> (  ) ;^54^^^^^^^[REPLACE] private final Map<Long, Position> positions = new ConcurrentHashMap<> (  ) ;^ [CLASS] DeviceManager  
[REPLACE]^this.dataManager =  null;^57^^^^^56^72^[REPLACE] this.dataManager = dataManager;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[REPLACE]^this.config  =  this.config ;^58^^^^^56^72^[REPLACE] this.config = Context.getConfig (  ) ;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[REPLACE]^dataRefreshDelay = config.getLong ( "database.refreshDelay", DEFAULT_REFRESH_DELAY )   1000;^59^^^^^56^72^[REPLACE] dataRefreshDelay = config.getLong ( "database.refreshDelay", DEFAULT_REFRESH_DELAY )  * 1000;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[REPLACE]^lookupGroupsAttribute ;^60^^^^^56^72^[REPLACE] lookupGroupsAttribute = config.getBoolean ( "deviceManager.lookupGroupsAttribute" ) ;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[REPLACE]^if  ( dataManager == null )  {^61^^^^^56^72^[REPLACE] if  ( dataManager != null )  {^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[ADD]^^61^62^63^64^^56^72^[ADD] if  ( dataManager != null )  { try { updateGroupCache ( true ) ; updateDeviceCache ( true ) ;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[ADD]^^65^66^67^^^62^68^[ADD] for  ( Position position : dataManager.getLatestPositions (  )  )  { positions.put ( position.getDeviceId (  ) , position ) ; }^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[ADD]^updateGroupCache ( true ) ;updateDeviceCache ( true ) ;positions.put ( position.getDeviceId (  ) , position ) ;^62^63^64^65^66^62^68^[ADD] try { updateGroupCache ( true ) ; updateDeviceCache ( true ) ; for  ( Position position : dataManager.getLatestPositions (  )  )  { positions.put ( position.getDeviceId (  ) , position ) ;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[REPLACE]^for  ( Position position : dataManager .updateLatestPosition ( position )   )  {^65^^^^^62^68^[REPLACE] for  ( Position position : dataManager.getLatestPositions (  )  )  {^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[ADD]^^68^69^^^^62^68^[ADD] catch  ( SQLException error )  { Log.warning ( error ) ;^[METHOD] <init> [TYPE] DataManager) [PARAMETER] DataManager dataManager [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  SQLException error  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay 
[ADD]^^76^^^^^74^127^[ADD] long lastUpdate = devicesLastUpdate.get (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  (  ( force || System.currentTimeMillis (  )  - lastUpdate > dataRefreshDelay ) || devicesLastUpdate.compareAndSet ( lastUpdate, System.currentTimeMillis (  )  )  )  {^77^78^^^^74^127^[REPLACE] if  (  ( force || System.currentTimeMillis (  )  - lastUpdate > dataRefreshDelay ) && devicesLastUpdate.compareAndSet ( lastUpdate, System.currentTimeMillis (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById != false )  {^81^^^^^77^126^[REPLACE] if  ( devicesById == null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^81^82^83^^^77^126^[ADD] if  ( devicesById == null )  { devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^82^^^^^77^126^[REPLACE] devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesByUniqueId != this  )  {^84^^^^^77^126^[REPLACE] if  ( devicesByUniqueId == null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^85^^^^^77^126^[REPLACE] devicesByUniqueId = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById.containsKey ( device.getName (   )  && ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  )  )  )  {^92^^^^^77^126^[REPLACE] if  ( devicesById.containsKey ( device.getId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^Device cachedDevice = devicesById.get ( device.getId (  )  ) ;cachedDevice.setName ( device.getName (  )  ) ;cachedDevice.setGroupId ( device.getGroupId (  )  ) ;cachedDevice.setAttributes ( device.getAttributes (  )  ) ;^92^93^94^95^96^77^126^[ADD] if  ( devicesById.containsKey ( device.getId (  )  )  )  { Device cachedDevice = devicesById.get ( device.getId (  )  ) ; cachedDevice.setName ( device.getName (  )  ) ; cachedDevice.setGroupId ( device.getGroupId (  )  ) ; cachedDevice.setAttributes ( device.getAttributes (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( geofenceManager == this )  {^105^^^^^92^112^[REPLACE] if  ( geofenceManager != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == null )  {^107^^^^^92^112^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ;^108^^^^^92^112^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  )  ;^108^^^^^92^112^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( cachedDevice.getId (  )  ) ;^106^^^^^92^112^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == false )  {^107^^^^^92^112^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.getString ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^108^^^^^92^112^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( position.getDeviceId (  )  )  ;^106^^^^^92^112^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !device.setUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^77^126^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device.getUniqueId (  )  ) ;^98^^^^^77^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REMOVE]^device.getUniqueId (  )  ;^98^^^^^77^126^[REMOVE] ^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device.getUniqueId (  ) , device )  ;^99^^^^^77^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( cachedDevice.getUniqueId (  ) , cachedDevice ) ;^99^^^^^77^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Device cachedDevice = cachedDevicesById.get ( device.getId (  )  ) ;^93^^^^^77^126^[REPLACE] Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^77^126^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^97^98^99^100^^77^126^[ADD] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  { devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device.setUniqueId (  )  ) ;^98^^^^^77^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device.setUniqueId (  ) , cachedDevice ) ;^99^^^^^77^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( geofenceManager == false )  {^105^^^^^77^126^[REPLACE] if  ( geofenceManager != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^Position lastPosition = getLastPosition ( device.getId (  )  ) ;device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^105^106^107^108^109^77^126^[ADD] if  ( geofenceManager != null )  { Position lastPosition = getLastPosition ( device.getId (  )  ) ; if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == true )  {^107^^^^^77^126^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device .setGroupId (  )  ;^108^^^^^77^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  )  ;^108^^^^^77^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( device.getName (  )  ) ;^106^^^^^77^126^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == this )  {^107^^^^^77^126^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^107^108^109^^^77^126^[ADD] if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.getString ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^108^^^^^77^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^108^^^^^77^126^[ADD] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesIds.contains ( cachedDeviceId  )  || ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  )  )  {^115^^^^^77^126^[REPLACE] if  ( !databaseDevicesIds.contains ( cachedDeviceId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById.remove ( deviceId )  ;^116^^^^^77^126^[REPLACE] devicesById.remove ( cachedDeviceId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  {^120^^^^^77^126^[REPLACE] if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^devicesByUniqueId.remove ( cachedDeviceUniqId ) ;^120^121^122^^^77^126^[ADD] if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  { devicesByUniqueId.remove ( cachedDeviceUniqId ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  )  ;^121^^^^^77^126^[REPLACE] devicesByUniqueId.remove ( cachedDeviceUniqId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^89^90^91^92^93^78^126^[ADD] for  ( Device device : databaseDevices )  { databaseDevicesIds.add ( device.getId (  )  ) ; databaseDevicesUniqueIds.add ( device.getUniqueId (  )  ) ; if  ( devicesById.containsKey ( device.getId (  )  )  )  { Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  && ( devicesById.containsKey ( device.getId (  )  )  )  {^92^^^^^78^126^[REPLACE] if  ( devicesById.containsKey ( device.getId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( geofenceManager == null )  {^105^^^^^92^112^[REPLACE] if  ( geofenceManager != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^Position lastPosition = getLastPosition ( device.getId (  )  ) ;device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^105^106^107^108^109^92^112^[ADD] if  ( geofenceManager != null )  { Position lastPosition = getLastPosition ( device.getId (  )  ) ; if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( device .getGroupId (  )   ) ;^106^^^^^92^112^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^108^^^^^92^112^[ADD] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !device.setUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^78^126^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^97^98^99^100^^78^126^[ADD] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  { devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( cachedDeviceUniqId )  ;^98^^^^^78^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device.getUniqueId (  )  ) ;^98^^^^^78^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REMOVE]^device.getUniqueId (  )  ;^98^^^^^78^126^[REMOVE] ^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device.getUniqueId (  ) , device )  ;^99^^^^^78^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^cachedDevice.getUniqueId (  )  ;^99^^^^^78^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Device cachedDevice = cachedDevicesById.get ( device.getId (  )  ) ;^93^^^^^78^126^[REPLACE] Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !device.getUniqueId (  )  .getUniqueId (  )   )  {^97^^^^^78^126^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^97^98^99^100^^78^126^[ADD] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  { devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device .setUniqueId (  )   ) ;^98^^^^^78^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^98^99^^^^78^126^[ADD] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( cachedDevice.getUniqueId (  ) , cachedDevice ) ;^99^^^^^78^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( geofenceManager == null )  {^105^^^^^78^126^[REPLACE] if  ( geofenceManager != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == null )  {^107^^^^^78^126^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^107^108^109^^^78^126^[ADD] if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ;^108^^^^^78^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  )  ;^108^^^^^78^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( cachedDevice .getGroupId (  )   ) ;^106^^^^^78^126^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == true )  {^107^^^^^78^126^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.getString ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^108^^^^^78^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REMOVE]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  )  ;^108^^^^^78^126^[REMOVE] ^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Device device = getDeviceById ( deviceId )  ;^93^^^^^78^126^[REPLACE] Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( position.getDeviceId (  )  )  ;^106^^^^^78^126^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesIds.contains ( cachedDeviceId  )  && ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  )  )  {^115^^^^^78^126^[REPLACE] if  ( !databaseDevicesIds.contains ( cachedDeviceId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^devicesById.remove ( cachedDeviceId ) ;^115^116^117^^^78^126^[ADD] if  ( !databaseDevicesIds.contains ( cachedDeviceId )  )  { devicesById.remove ( cachedDeviceId ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById .isEmpty (  )  ;^116^^^^^78^126^[REPLACE] devicesById.remove ( cachedDeviceId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^119^120^121^122^^78^126^[ADD] for  ( String cachedDeviceUniqId : devicesByUniqueId.keySet (  )  )  { if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  { devicesByUniqueId.remove ( cachedDeviceUniqId ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesUniqueIds.add ( cachedDeviceUniqId )  )  {^120^^^^^78^126^[REPLACE] if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  )  ;^121^^^^^78^126^[REPLACE] devicesByUniqueId.remove ( cachedDeviceUniqId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^121^^^^^78^126^[ADD] devicesByUniqueId.remove ( cachedDeviceUniqId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^82^^^^^78^126^[REPLACE] devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^85^^^^^78^126^[ADD] devicesByUniqueId = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^GeofenceManager geofenceManager = Context.getConnectionManager (  ) ;^79^^^^^78^126^[REPLACE] GeofenceManager geofenceManager = Context.getGeofenceManager (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Group> databaseGroups = dataManager.getAllGroups (  )  ;^80^^^^^78^126^[REPLACE] Collection<Device> databaseDevices = dataManager.getAllDevices (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^87^88^^^^78^126^[ADD] Set<Long> databaseDevicesIds = new HashSet<> (  ) ; Set<String> databaseDevicesUniqueIds = new HashSet<> (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Long> databaseDevicesIds = new HashSet<> (  )  ;^88^^^^^78^126^[REPLACE] Set<String> databaseDevicesUniqueIds = new HashSet<> (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Group group  ;^89^^^^^78^126^[REPLACE] for  ( Device device : databaseDevices )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^93^^^^^78^126^[ADD] Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^106^^^^^78^126^[ADD] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Long cachedGroupId  ;^114^^^^^78^126^[REPLACE] for  ( Long cachedDeviceId : devicesById.keySet (  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Long cachedDeviceId  ;^119^^^^^78^126^[REPLACE] for  ( String cachedDeviceUniqId : devicesByUniqueId.keySet (  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  && ( devicesById != null )  {^81^^^^^74^127^[REPLACE] if  ( devicesById == null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^82^^^^^74^127^[REPLACE] devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( ! ( databaseDevicesIds.contains ( cachedDeviceId )  )  || ( devicesByUniqueId != true )  {^84^^^^^74^127^[REPLACE] if  ( devicesByUniqueId == null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^84^85^86^^^74^127^[ADD] if  ( devicesByUniqueId == null )  { devicesByUniqueId = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^85^^^^^74^127^[REPLACE] devicesByUniqueId = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById.containsKey ( device.getId (   )  || ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  )  )  )  {^92^^^^^74^127^[REPLACE] if  ( devicesById.containsKey ( device.getId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^Device cachedDevice = devicesById.get ( device.getId (  )  ) ;cachedDevice.setName ( device.getName (  )  ) ;cachedDevice.setGroupId ( device.getGroupId (  )  ) ;cachedDevice.setAttributes ( device.getAttributes (  )  ) ;^92^93^94^95^96^74^127^[ADD] if  ( devicesById.containsKey ( device.getId (  )  )  )  { Device cachedDevice = devicesById.get ( device.getId (  )  ) ; cachedDevice.setName ( device.getName (  )  ) ; cachedDevice.setGroupId ( device.getGroupId (  )  ) ; cachedDevice.setAttributes ( device.getAttributes (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device .setGroupId (  )  ;^108^^^^^92^112^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^107^108^109^^^92^112^[ADD] if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !device.setUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^74^127^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^97^98^99^100^^74^127^[ADD] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  { devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( cachedDeviceUniqId )  ;^98^^^^^74^127^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^98^99^^^^74^127^[ADD] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ; devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.getUniqueId (  )  ;^98^^^^^74^127^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^98^^^^^74^127^[ADD] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device.getUniqueId (  ) , device )  ;^99^^^^^74^127^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( cachedDevice.getUniqueId (  ) , cachedDevice ) ;^99^^^^^74^127^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^99^^^^^74^127^[ADD] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^cachedDevice.setName ( device.getName (  )  ) ;^93^94^^^^74^127^[ADD] Device cachedDevice = devicesById.get ( device.getId (  )  ) ; cachedDevice.setName ( device.getName (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById.containsKey ( device.getId (  )  )  || ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^74^127^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device.getUniqueId (  )  ) ;^98^^^^^74^127^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( device.setUniqueId (  )  ) ;^98^^^^^74^127^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( geofenceManager == null )  {^105^^^^^74^127^[REPLACE] if  ( geofenceManager != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == false )  {^107^^^^^74^127^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^107^108^109^^^74^127^[ADD] if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ;^108^^^^^74^127^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  )  ;^108^^^^^74^127^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^108^^^^^74^127^[ADD] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( device.getName (  )  ) ;^106^^^^^74^127^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == null )  {^107^^^^^74^127^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^107^108^109^^^74^127^[ADD] if  ( lastPosition != null )  { device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ; }^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( databaseDevicesIds.contains ( cachedDeviceId )  )  {^115^^^^^74^127^[REPLACE] if  ( !databaseDevicesIds.contains ( cachedDeviceId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById.remove ( deviceId )  ;^116^^^^^74^127^[REPLACE] devicesById.remove ( cachedDeviceId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesUniqueIds .clear (  )   )  {^120^^^^^74^127^[REPLACE] if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  )  ;^121^^^^^74^127^[REPLACE] devicesByUniqueId.remove ( cachedDeviceUniqId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^for  ( Device device : true )  {^89^^^^^78^126^[REPLACE] for  ( Device device : databaseDevices )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById.containsKey ( device.getId (   )  || ! ( device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  )  )  )  {^92^^^^^78^126^[REPLACE] if  ( devicesById.containsKey ( device.getId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == this  )  {^107^^^^^92^112^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^106^^^^^92^112^[ADD] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == true )  {^107^^^^^92^112^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !device.setUniqueId (   )  || devicesById.containsKey ( device.getId (  )  )  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^97^^^^^78^126^[REPLACE] if  ( !device.getUniqueId (  ) .equals ( cachedDevice.getUniqueId (  )  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device.getUniqueId (  )  ;^98^^^^^78^126^[REPLACE] devicesByUniqueId.remove ( cachedDevice.getUniqueId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device .setUniqueId (  )  , cachedDevice ) ;^99^^^^^78^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Device cachedDevice = cachedDevicesById.get ( device .getGroupId (  )   ) ;^93^^^^^78^126^[REPLACE] Device cachedDevice = devicesById.get ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesByUniqueId.put ( device.setUniqueId (  ) , cachedDevice ) ;^99^^^^^78^126^[REPLACE] devicesByUniqueId.put ( device.getUniqueId (  ) , cachedDevice ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( lastPosition == this )  {^107^^^^^78^126^[REPLACE] if  ( lastPosition != null )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^device .setGroupId (  )  ;^108^^^^^78^126^[REPLACE] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^108^^^^^78^126^[ADD] device.setGeofenceIds ( geofenceManager.getCurrentDeviceGeofences ( lastPosition )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Position lastPosition = getLastPosition ( cachedDevice.getId (  )  ) ;^106^^^^^78^126^[REPLACE] Position lastPosition = getLastPosition ( device.getId (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^for  ( Long cachedDeviceId : devicesById.get (  )  )  {^114^^^^^78^126^[REPLACE] for  ( Long cachedDeviceId : devicesById.keySet (  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesIds .clear (  )   )  {^115^^^^^78^126^[REPLACE] if  ( !databaseDevicesIds.contains ( cachedDeviceId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById.remove ( deviceId )  ;^116^^^^^78^126^[REPLACE] devicesById.remove ( cachedDeviceId ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REMOVE]^devicesById.remove ( deviceId )  ;^116^^^^^78^126^[REMOVE] ^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^for  ( String cachedDeviceUniqId : devicesByUniqueId .get (  )   )  {^119^^^^^78^126^[REPLACE] for  ( String cachedDeviceUniqId : devicesByUniqueId.keySet (  )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( !databaseDevicesUniqueIds.add ( cachedDeviceUniqId  )  || devicesById.containsKey ( device.getId (  )  )  )  )  {^120^^^^^78^126^[REPLACE] if  ( !databaseDevicesUniqueIds.contains ( cachedDeviceUniqId )  )  {^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^82^^^^^78^126^[ADD] devicesById = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^devicesById = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^85^^^^^78^126^[REPLACE] devicesByUniqueId = new ConcurrentHashMap<> ( databaseDevices.size (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^79^^^^^78^126^[ADD] GeofenceManager geofenceManager = Context.getGeofenceManager (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^80^^^^^78^126^[ADD] Collection<Device> databaseDevices = dataManager.getAllDevices (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^Long> databaseGroupsIds = new HashSet<> (  )  ;^87^^^^^78^126^[REPLACE] Set<Long> databaseDevicesIds = new HashSet<> (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^88^^^^^78^126^[ADD] Set<String> databaseDevicesUniqueIds = new HashSet<> (  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[ADD]^^93^94^^^^78^126^[ADD] Device cachedDevice = devicesById.get ( device.getId (  )  ) ; cachedDevice.setName ( device.getName (  )  ) ;^[METHOD] updateDeviceCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Set databaseDevicesIds  databaseDevicesUniqueIds  [TYPE]  Position lastPosition  [TYPE]  Config config  [TYPE]  GeofenceManager geofenceManager  [TYPE]  Device cachedDevice  device  [TYPE]  DataManager dataManager  [TYPE]  String cachedDeviceUniqId  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  lastUpdate  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  lookupGroupsAttribute  true  [TYPE]  Long cachedDeviceId  [TYPE]  Collection databaseDevices  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions 
[REPLACE]^if  ( devicesById.containsKey ( position.getDeviceId (  )  )  && ( isLatestPosition ( position )  )  {^203^^^^^201^217^[REPLACE] if  ( isLatestPosition ( position )  )  {^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^203^204^205^^^201^217^[ADD] if  ( isLatestPosition ( position )  )  {  dataManager.updateLatestPosition ( position ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( isLatestPosition ( position )  && ( devicesById.containsKey ( position.getDeviceId (  )  )  )  {^207^^^^^201^217^[REPLACE] if  ( devicesById.containsKey ( position.getDeviceId (  )  )  )  {^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.get ( position.getDeviceId (  )  ) .getGroupPermissions ( position.getId (  )  ) ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.containsKey ( position.getDeviceId (  )  )  ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^208^^^^^201^217^[ADD] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^positions.get ( deviceId )  ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getDeviceId (  )  ) ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( Context.getConnectionManager (  )  == null )  {^213^^^^^201^217^[REPLACE] if  ( Context.getConnectionManager (  )  != null )  {^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Context.getConnectionManager (  )  .setPositionId (  )  ;^214^^^^^201^217^[REPLACE] Context.getConnectionManager (  ) .updatePosition ( position ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Context .getPermissionsManager (  )  .updatePosition ( position ) ;^214^^^^^201^217^[REPLACE] Context.getConnectionManager (  ) .updatePosition ( position ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( devicesById.containsKey ( position .getId (  )   )  )  {^207^^^^^201^217^[REPLACE] if  ( devicesById.containsKey ( position.getDeviceId (  )  )  )  {^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REMOVE]^devicesById.containsKey ( position.getDeviceId (  )  )  ;^208^^^^^201^217^[REMOVE] ^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.get ( position.getId (  )  ) .setPositionId ( position.getId (  )  ) ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^position.getDeviceId (  )  ;^208^^^^^201^217^[REPLACE] devicesById.get ( position.getDeviceId (  )  ) .setPositionId ( position.getId (  )  ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( Context.getConnectionManager (   )  && devicesById.containsKey ( position.getDeviceId (  )  )  )  == false )  {^213^^^^^201^217^[REPLACE] if  ( Context.getConnectionManager (  )  != null )  {^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Context.getPermissionsManager (  ) .updatePosition ( position ) ;^214^^^^^201^217^[REPLACE] Context.getConnectionManager (  ) .updatePosition ( position ) ;^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REMOVE]^getConnectionManager (  )  ;^214^^^^^201^217^[REMOVE] ^[METHOD] updateLatestPosition [TYPE] void [PARAMETER] Position position [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Position position  [TYPE]  Config config  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^long lastUpdate = groupsLastUpdate.AtomicLong (  ) ;^241^^^^^239^266^[REPLACE] long lastUpdate = groupsLastUpdate.get (  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  (  System.currentTimeMillis (  )  - lastUpdate > dataRefreshDelay ) || groupsLastUpdate.compareAndSet ( lastUpdate, System.currentTimeMillis (  )  )  )  {^242^243^^^^239^266^[REPLACE] if  (  ( force || System.currentTimeMillis (  )  - lastUpdate > dataRefreshDelay ) && groupsLastUpdate.compareAndSet ( lastUpdate, System.currentTimeMillis (  )  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^242^243^244^245^246^239^266^[ADD] if  (  ( force || System.currentTimeMillis (  )  - lastUpdate > dataRefreshDelay ) && groupsLastUpdate.compareAndSet ( lastUpdate, System.currentTimeMillis (  )  )  )  { Collection<Group> databaseGroups = dataManager.getAllGroups (  ) ; if  ( groupsById == null )  { groupsById = new ConcurrentHashMap<> ( databaseGroups.size (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById != null  && ! ( databaseGroupsIds.contains ( cachedGroupId )  )  )  {^245^^^^^242^265^[REPLACE] if  ( groupsById == null )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^246^^^^^242^265^[ADD] groupsById = new ConcurrentHashMap<> ( databaseGroups.size (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById.containsKey ( group .getGroupId (  )   )  )  {^251^^^^^242^265^[REPLACE] if  ( groupsById.containsKey ( group.getId (  )  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^groupsById.put ( cachedGroup.getId (  ) , group ) ;^256^^^^^251^257^[REPLACE] groupsById.put ( group.getId (  ) , group ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REMOVE]^groupsById.get ( group.getId (  )  )  ;^256^^^^^251^257^[REMOVE] ^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^group.getName (  )  ;^256^^^^^251^257^[REPLACE] groupsById.put ( group.getId (  ) , group ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Group cachedGroup = cachedGroupsById.get ( group.getName (  )  ) ;^252^^^^^242^265^[REPLACE] Group cachedGroup = groupsById.get ( group.getId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( databaseGroupsIds.contains ( cachedGroupId )  )  {^260^^^^^242^265^[REPLACE] if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.remove ( cachedDeviceId )  ;^261^^^^^242^265^[REPLACE] devicesById.remove ( cachedGroupId ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^for  ( Group cachedGroup : databaseGroups )  {^249^^^^^243^265^[REPLACE] for  ( Group group : databaseGroups )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById.containsKey ( group.getName (  )  )  )  {^251^^^^^243^265^[REPLACE] if  ( groupsById.containsKey ( group.getId (  )  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^251^252^253^254^^243^265^[ADD] if  ( groupsById.containsKey ( group.getId (  )  )  )  { Group cachedGroup = groupsById.get ( group.getId (  )  ) ; cachedGroup.setName ( group.getName (  )  ) ; cachedGroup.setGroupId ( group.getGroupId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^256^^^^^251^257^[ADD] groupsById.put ( group.getId (  ) , group ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Group cachedGroup = cachedGroupsById.get ( group.getId (  )  ) ;^252^^^^^243^265^[REPLACE] Group cachedGroup = groupsById.get ( group.getId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^252^^^^^243^265^[ADD] Group cachedGroup = groupsById.get ( group.getId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^for  ( Long cachedGroupId : groupsById.get (  )  )  {^259^^^^^243^265^[REPLACE] for  ( Long cachedGroupId : groupsById.keySet (  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( !databaseGroupsIds.add ( cachedGroupId )  )  {^260^^^^^243^265^[REPLACE] if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById.remove ( cachedDeviceId )  ;^261^^^^^243^265^[REPLACE] devicesById.remove ( cachedGroupId ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^246^^^^^243^265^[REPLACE] groupsById = new ConcurrentHashMap<> ( databaseGroups.size (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Collection<Group> databaseGroups = dataManager .getAllDevices (  )  ;^244^^^^^243^265^[REPLACE] Collection<Group> databaseGroups = dataManager.getAllGroups (  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Long> databaseDevicesIds = new HashSet<> (  )  ;^248^^^^^243^265^[REPLACE] Set<Long> databaseGroupsIds = new HashSet<> (  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Device device  ;^249^^^^^243^265^[REPLACE] for  ( Group group : databaseGroups )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Device cachedDevice = devicesById.get ( device.getId (  )  )  ;^252^^^^^243^265^[REPLACE] Group cachedGroup = groupsById.get ( group.getId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Long cachedDeviceId  ;^259^^^^^243^265^[REPLACE] for  ( Long cachedGroupId : groupsById.keySet (  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById != null )  {^245^^^^^239^266^[REPLACE] if  ( groupsById == null )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById = new ConcurrentHashMap ( databaseDevices.size (  )  )  ;^246^^^^^239^266^[REPLACE] groupsById = new ConcurrentHashMap<> ( databaseGroups.size (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById .keySet (  )   )  {^251^^^^^239^266^[REPLACE] if  ( groupsById.containsKey ( group.getId (  )  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^groupsById.get ( group.getId (  )  )  ;^256^^^^^251^257^[REPLACE] groupsById.put ( group.getId (  ) , group ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^groupsById.put ( group.getName (  ) , group ) ;^256^^^^^251^257^[REPLACE] groupsById.put ( group.getId (  ) , group ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REMOVE]^group.getName (  )  ;^256^^^^^251^257^[REMOVE] ^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^Device cachedDevice = devicesById.get ( device.getId (  )  )  ;^252^^^^^239^266^[REPLACE] Group cachedGroup = groupsById.get ( group.getId (  )  ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById.containsKey ( group.getId (  )  )  && ( !databaseGroupsIds.add ( cachedGroupId )  )  {^260^^^^^239^266^[REPLACE] if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^devicesById .isEmpty (  )  ;^261^^^^^239^266^[REPLACE] devicesById.remove ( cachedGroupId ) ;^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById.containsKey ( group.getId (   )  || ! ( databaseGroupsIds.contains ( cachedGroupId )  )  )  )  )  {^251^^^^^243^265^[REPLACE] if  ( groupsById.containsKey ( group.getId (  )  )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^^259^260^261^262^^243^265^[ADD] for  ( Long cachedGroupId : groupsById.keySet (  )  )  { if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  { devicesById.remove ( cachedGroupId ) ; }^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^if  ( groupsById.containsKey ( group.getId (  )  )  && ( !databaseGroupsIds.contains ( cachedGroupId )  )  {^260^^^^^243^265^[REPLACE] if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  {^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[ADD]^devicesById.remove ( cachedGroupId ) ;^260^261^262^^^243^265^[ADD] if  ( !databaseGroupsIds.contains ( cachedGroupId )  )  { devicesById.remove ( cachedGroupId ) ; }^[METHOD] updateGroupCache [TYPE] void [PARAMETER] boolean force [CLASS] DeviceManager   [TYPE]  Group cachedGroup  group  [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean false  force  forceUpdate  lookupGroupsAttribute  true  [TYPE]  Set databaseGroupsIds  [TYPE]  Config config  [TYPE]  Long cachedGroupId  [TYPE]  Collection databaseGroups  [TYPE]  DataManager dataManager  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  deviceId  id  lastUpdate  userId 
[REPLACE]^String result = this;^365^^^^^364^393^[REPLACE] String result = null;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^366^^^^^364^393^[ADD] Device device = getDeviceById ( deviceId ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( device == true )  {^367^^^^^364^393^[REPLACE] if  ( device != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result != null &&true )  {^369^^^^^364^393^[REPLACE] if  ( result == null && lookupGroupsAttribute )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( getGroupById ( groupId )  == null )  {^372^^^^^364^393^[REPLACE] if  ( getGroupById ( groupId )  != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^result = getGroupById ( groupId ) .getString ( attributeName ) ;break;^372^373^374^375^376^364^393^[ADD] if  ( getGroupById ( groupId )  != null )  { result = getGroupById ( groupId ) .getString ( attributeName ) ; if  ( result != null )  { break; }^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId = 0 >>> 2;^379^^^^^372^380^[REPLACE] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result == null )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^break;^374^375^376^^^364^393^[ADD] if  ( result != null )  { break; }^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result =  getGroupById ( userId ) .getString ( attributeName ) ;^373^^^^^364^393^[REPLACE] result = getGroupById ( groupId ) .getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId =  getGroupById ( userId ) .getGroupId (  ) ;^377^^^^^364^393^[REPLACE] groupId = getGroupById ( groupId ) .getGroupId (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result == this  )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result =  getGroupById ( null ) .getString ( attributeName ) ;^373^^^^^364^393^[REPLACE] result = getGroupById ( groupId ) .getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^group = groupsById.get ( group.getGroupId (  )  )  ;^377^^^^^364^393^[REPLACE] groupId = getGroupById ( groupId ) .getGroupId (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId = 2;^379^^^^^364^393^[REPLACE] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^long groupId = device.setGroupId (  ) ;^370^^^^^364^393^[REPLACE] long groupId = device.getGroupId (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( getGroupById ( groupId )  == this  )  {^372^^^^^364^393^[REPLACE] if  ( getGroupById ( groupId )  != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^379^^^^^372^380^[ADD] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result == false )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result = server.getString ( attributeName )  ;^373^^^^^364^393^[REPLACE] result = getGroupById ( groupId ) .getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^377^^^^^364^393^[ADD] groupId = getGroupById ( groupId ) .getGroupId (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result !=attributeName )  {^383^^^^^364^393^[REPLACE] if  ( result == null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^383^384^385^386^387^364^393^[ADD] if  ( result == null )  { if  ( lookupConfig )  { result = Context.getConfig (  ) .getString ( attributeName ) ; } else { Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( true )  {^384^^^^^364^393^[REPLACE] if  ( lookupConfig )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result = device.getString ( attributeName )  ;^388^^^^^384^389^[REPLACE] result = server.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^Server server = Context .getConnectionManager (  )  .getServer (  ) ;^387^^^^^384^389^[REPLACE] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result =  Context.getConfig (  ) .getString ( null ) ;^385^^^^^364^393^[REPLACE] result = Context.getConfig (  ) .getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result = device.getString ( attributeName )  ;^388^^^^^364^393^[REPLACE] result = server.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^Server server = Context.getConnectionManager (  ) .getServer (  ) ;^387^^^^^364^393^[REPLACE] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^384^385^386^387^388^364^393^[ADD] if  ( lookupConfig )  { result = Context.getConfig (  ) .getString ( attributeName ) ; } else { Server server = Context.getPermissionsManager (  ) .getServer (  ) ; result = server.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^388^^^^^384^389^[ADD] result = server.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^Server server = Context.getPermissionsManager (  ) .getDevicePermissions (  ) ;^387^^^^^384^389^[REPLACE] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^result = server.getString ( attributeName )  ;^368^^^^^364^393^[REPLACE] result = device.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId =  getGroupById ( id ) .getGroupId (  ) ;^377^^^^^364^393^[REPLACE] groupId = getGroupById ( groupId ) .getGroupId (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId = 0L;^379^^^^^364^393^[REPLACE] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( true )  {^369^^^^^364^393^[REPLACE] if  ( result == null && lookupGroupsAttribute )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId = 0L;^379^^^^^372^380^[REPLACE] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( attributeName == this )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^groupId = 4;^379^^^^^364^393^[REPLACE] groupId = 0;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( getGroupById ( groupId )  == false )  {^372^^^^^364^393^[REPLACE] if  ( getGroupById ( groupId )  != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( attributeName ==attributeName )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( result ==attributeName )  {^374^^^^^364^393^[REPLACE] if  ( result != null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^if  ( attributeName != null )  {^383^^^^^364^393^[REPLACE] if  ( result == null )  {^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^Server server = Context.getConnectionManager (  ) .getServer (  ) ;^387^^^^^384^389^[REPLACE] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^388^^^^^364^393^[ADD] result = server.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^Server server = Context.getPermissionsManager (  ) .getDevicePermissions (  ) ;^387^^^^^364^393^[REPLACE] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^387^^^^^384^389^[ADD] Server server = Context.getPermissionsManager (  ) .getServer (  ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[ADD]^^368^^^^^364^393^[ADD] result = device.getString ( attributeName ) ;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
[REPLACE]^return attributeName;^392^^^^^364^393^[REPLACE] return result;^[METHOD] lookupAttribute [TYPE] String [PARAMETER] long deviceId String attributeName boolean lookupConfig [CLASS] DeviceManager   [TYPE]  AtomicLong devicesLastUpdate  groupsLastUpdate  [TYPE]  boolean defaultValue  false  force  forceUpdate  lookupConfig  lookupGroupsAttribute  true  [TYPE]  Server server  [TYPE]  Config config  [TYPE]  Device device  [TYPE]  DataManager dataManager  [TYPE]  String attributeName  result  [TYPE]  Map devicesById  devicesByUniqueId  groupsById  positions  [TYPE]  long DEFAULT_REFRESH_DELAY  dataRefreshDelay  defaultValue  deviceId  groupId  id  lastUpdate  userId 
