[REPLACE]^private final Object dataManager;^38^^^^^^^[REPLACE] private final DataManager dataManager;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<Long, User> users ;^42^^^^^^^[REPLACE] private final Map<Long, User> users = new ConcurrentHashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<String, Long> usersTokens ;^43^^^^^^^[REPLACE] private final Map<String, Long> usersTokens = new HashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<Long, Set<Long>> groupPermissions  = null ;^45^^^^^^^[REPLACE] private final Map<Long, Set<Long>> groupPermissions = new HashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<Long, Set<Long>> devicePermissions  = null ;^46^^^^^^^[REPLACE] private final Map<Long, Set<Long>> devicePermissions = new HashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<Long, Set<Long>> deviceUsers ;^47^^^^^^^[REPLACE] private final Map<Long, Set<Long>> deviceUsers = new HashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^private final Map<Long, Set<Long>> groupDevices ;^48^^^^^^^[REPLACE] private final Map<Long, Set<Long>> groupDevices = new HashMap<> (  ) ;^ [CLASS] PermissionsManager  
[REPLACE]^devicePermissions.clear (  )  ;^101^^^^^100^137^[REPLACE] groupPermissions.clear (  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^101^^^^^100^137^[ADD] groupPermissions.clear (  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^devicePermissions .get ( null )  ;^102^^^^^100^137^[REPLACE] devicePermissions.clear (  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^106^107^108^109^^103^128^[ADD] for  ( GroupPermission permission : dataManager.getGroupPermissions (  )  )  { Set<Long> userGroupPermissions = getGroupPermissions ( permission.getUserId (  )  ) ; Set<Long> userDevicePermissions = getDevicePermissions ( permission.getUserId (  )  ) ; userGroupPermissions.add ( permission.getGroupId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^110^111^112^^^106^116^[ADD] for  ( Group group : groupTree.getGroups ( permission.getGroupId (  )  )  )  { userGroupPermissions.add ( group.getId (  )  ) ; }^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( Device device : groupTree.getDevices ( permission.getUserId (  )  )  )  {^113^^^^^106^116^[REPLACE] for  ( Device device : groupTree.getDevices ( permission.getGroupId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^Set<Long> userGroupPermissions = getGroupPermissions ( permission .getGroupId (  )   ) ;^107^^^^^106^116^[REPLACE] Set<Long> userGroupPermissions = getGroupPermissions ( permission.getUserId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^Set<Long> userDevicePermissions = getDevicePermissions ( permission.getGroupId (  )  ) ;^108^^^^^106^116^[REPLACE] Set<Long> userDevicePermissions = getDevicePermissions ( permission.getUserId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^User user  ;^110^^^^^106^116^[REPLACE] for  ( Group group : groupTree.getGroups ( permission.getGroupId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^113^114^115^^^106^116^[ADD] for  ( Device device : groupTree.getDevices ( permission.getGroupId (  )  )  )  { userDevicePermissions.add ( device.getId (  )  ) ; }^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( Group group : groupTree.getGroups ( permission.getUserId (  )  )  )  {^110^^^^^106^116^[REPLACE] for  ( Group group : groupTree.getGroups ( permission.getGroupId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( DevicePermission permission : dataManager.getGroupPermissions (  )  )  {^117^^^^^106^116^[REPLACE] for  ( DevicePermission permission : dataManager.getDevicePermissions (  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( Device device : groupTree.getDevices ( group .getAdmin (  )   )  )  {^123^^^^^106^116^[REPLACE] for  ( Device device : groupTree.getDevices ( group.getId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^Context.getDeviceManager (  ) .getAllDevices (  )  ) ;Set<Long> userGroupPermissions = getGroupPermissions ( permission.getUserId (  )  ) ;^103^104^105^106^107^106^116^[ADD] try { GroupTree groupTree = new GroupTree ( Context.getDeviceManager (  ) .getAllGroups (  ) , Context.getDeviceManager (  ) .getAllDevices (  )  ) ; for  ( GroupPermission permission : dataManager.getGroupPermissions (  )  )  { Set<Long> userGroupPermissions = getGroupPermissions ( permission.getUserId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^GroupTree groupTree = new GroupTree ( Context.getDeviceManager (  )  .getAllDevices (  )  , Context.getDeviceManager (  ) .getAllDevices (  )  ) ;^104^105^^^^106^116^[REPLACE] GroupTree groupTree = new GroupTree ( Context.getDeviceManager (  ) .getAllGroups (  ) , Context.getDeviceManager (  ) .getAllDevices (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^DevicePermission permission  ;^106^^^^^106^116^[REPLACE] for  ( GroupPermission permission : dataManager.getGroupPermissions (  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^107^108^^^^106^116^[ADD] Set<Long> userGroupPermissions = getGroupPermissions ( permission.getUserId (  )  ) ; Set<Long> userDevicePermissions = getDevicePermissions ( permission.getUserId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^Set<Long> userDevicePermissions = getDevicePermissions ( permission .getGroupId (  )   ) ;^108^^^^^106^116^[REPLACE] Set<Long> userDevicePermissions = getDevicePermissions ( permission.getUserId (  )  ) ;^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^User user  ;^113^^^^^106^116^[REPLACE] for  ( Device device : groupTree.getDevices ( permission.getGroupId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^117^118^119^^^106^116^[ADD] for  ( DevicePermission permission : dataManager.getDevicePermissions (  )  )  { getDevicePermissions ( permission.getUserId (  )  ) .add ( permission.getDeviceId (  )  ) ; }^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[ADD]^^122^123^124^125^^106^116^[ADD] for  ( Group group : Context.getDeviceManager (  ) .getAllGroups (  )  )  { for  ( Device device : groupTree.getDevices ( group.getId (  )  )  )  { getGroupDevices ( group.getId (  )  ) .add ( device.getId (  )  ) ; }^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^User user  ;^123^^^^^106^116^[REPLACE] for  ( Device device : groupTree.getDevices ( group.getId (  )  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( Map.Entry<Long, Set<Long>> true : devicePermissions.entrySet (  )  )  {^132^^^^^100^137^[REPLACE] for  ( Map.Entry<Long, Set<Long>> entry : devicePermissions.entrySet (  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( long deviceId : true.getValue (  )  )  {^133^^^^^132^136^[REPLACE] for  ( long deviceId : entry.getValue (  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
[REPLACE]^for  ( long deviceId : 0.getValue (  )  )  {^133^^^^^132^136^[REPLACE] for  ( long deviceId : entry.getValue (  )  )  {^[METHOD] refreshPermissions [TYPE] void [PARAMETER] [CLASS] PermissionsManager   [TYPE]  Group group  [TYPE]  Set userDevicePermissions  userGroupPermissions  [TYPE]  Server server  [TYPE]  SQLException error  [TYPE]  Device device  [TYPE]  DevicePermission permission  [TYPE]  DataManager dataManager  [TYPE]  GroupPermission permission  [TYPE]  long deviceId  [TYPE]  GroupTree groupTree  [TYPE]  Entry entry  [TYPE]  boolean false  true  [TYPE]  Map devicePermissions  deviceUsers  groupDevices  groupPermissions  users  usersTokens 
