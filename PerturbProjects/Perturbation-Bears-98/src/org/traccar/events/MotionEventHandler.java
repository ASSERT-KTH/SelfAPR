[REPLACE]^Position lastPosition = getIdentityManager (  ) .getLastPosition ( position.getDeviceId (  )  )  ;^38^^^^^36^60^[REPLACE] Device device = Context.getIdentityManager (  ) .getDeviceById ( position.getDeviceId (  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^if  ( device != null )  {^39^^^^^36^60^[REPLACE] if  ( device == null )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return false;^40^^^^^36^60^[REPLACE] return null;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^if  ( Context.getIdentityManager (  ) .isLatestPosition ( position )  ) {^42^^^^^36^60^[REPLACE] if  ( !Context.getIdentityManager (  ) .isLatestPosition ( position )  || !position.getValid (  )  )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return this;^43^^^^^36^60^[REPLACE] return null;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return false;^43^^^^^36^60^[REPLACE] return null;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^double speed = lastPosition.getSpeed (  ) ;^46^^^^^36^60^[REPLACE] double speed = position.getSpeed (  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[ADD]^^47^^^^^36^60^[ADD] double oldSpeed = 0;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^Device device = getIdentityManager (  ) .getDeviceById ( position.getDeviceId (  )  )  ;^48^^^^^36^60^[REPLACE] Position lastPosition = Context.getIdentityManager (  ) .getLastPosition ( position.getDeviceId (  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^if  (position == true )  {^49^^^^^36^60^[REPLACE] if  ( lastPosition != null )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[ADD]^^49^50^51^^^36^60^[ADD] if  ( lastPosition != null )  { oldSpeed = lastPosition.getSpeed (  ) ; }^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^oldSpeed =  position.getSpeed (  ) ;^50^^^^^36^60^[REPLACE] oldSpeed = lastPosition.getSpeed (  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^if  (true || oldSpeed <= speedThreshold )  {^52^^^^^36^60^[REPLACE] if  ( speed > speedThreshold && oldSpeed <= speedThreshold )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[ADD]^^52^53^54^55^56^36^60^[ADD] if  ( speed > speedThreshold && oldSpeed <= speedThreshold )  { return Collections.singleton ( new Event ( Event.TYPE_DEVICE_MOVING, position.getDeviceId (  ) , position.getId (  )  )  ) ; } else if  ( speed <= speedThreshold && oldSpeed > speedThreshold )  { return Collections.singleton (^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^}  else {^55^^^^^36^60^[REPLACE] } else if  ( speed <= speedThreshold && oldSpeed > speedThreshold )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return Collections.singleton ( new Event ( Event.TYPE_DEVICE_STOPPED, lastPosition.getDeviceId (  ) , position.getId (  )  )  ) ;^56^57^^^^36^60^[REPLACE] return Collections.singleton ( new Event ( Event.TYPE_DEVICE_STOPPED, position.getDeviceId (  ) , position.getId (  )  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return Collections.singleton ( new Event ( Event.TYPE_DEVICE_STOPPED, lastPosition .getValid (  )  , position.getId (  )  )  ) ;^56^57^^^^36^60^[REPLACE] return Collections.singleton ( new Event ( Event.TYPE_DEVICE_STOPPED, position.getDeviceId (  ) , position.getId (  )  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return Collections.singleton ( new Event ( Event.TYPE_DEVICE_MOVING, lastPosition.getValid (  ) , position.getId (  )  )  ) ;^53^54^^^^36^60^[REPLACE] return Collections.singleton ( new Event ( Event.TYPE_DEVICE_MOVING, position.getDeviceId (  ) , position.getId (  )  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^}  if  ( speed <= speedThreshold ||true )  {^55^^^^^36^60^[REPLACE] } else if  ( speed <= speedThreshold && oldSpeed > speedThreshold )  {^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return Collections.singleton ( new Event ( Event.TYPE_DEVICE_MOVING, lastPosition.getDeviceId (  ) , position.getId (  )  )  ) ;^53^54^^^^36^60^[REPLACE] return Collections.singleton ( new Event ( Event.TYPE_DEVICE_MOVING, position.getDeviceId (  ) , position.getId (  )  )  ) ;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
[REPLACE]^return false;^59^^^^^36^60^[REPLACE] return null;^[METHOD] analyzePosition [TYPE] Collection [PARAMETER] Position position [CLASS] MotionEventHandler   [TYPE]  boolean false  true  [TYPE]  Position lastPosition  position  [TYPE]  double oldSpeed  speed  speedThreshold  [TYPE]  Device device 
