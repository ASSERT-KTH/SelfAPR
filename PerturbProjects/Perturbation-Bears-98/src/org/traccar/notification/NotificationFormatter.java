[REPLACE]^Device device = Context.getGeofenceManager (  ) .getDeviceById ( event.getDeviceId (  )  ) ;^36^^^^^35^62^[REPLACE] Device device = Context.getIdentityManager (  ) .getDeviceById ( event.getDeviceId (  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^velocityContext.put ( "device", device ) ;^38^39^^^^35^62^[ADD] VelocityContext velocityContext = new VelocityContext (  ) ; velocityContext.put ( "device", device ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "event", event )  ;^39^^^^^35^62^[REPLACE] velocityContext.put ( "device", device ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REMOVE]^velocityContext.put ( "event", event )  ;^39^^^^^35^62^[REMOVE] ^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "device", device )  ;^40^^^^^35^62^[REPLACE] velocityContext.put ( "event", event ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^40^^^^^35^62^[ADD] velocityContext.put ( "event", event ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^if  ( position == null )  {^41^^^^^35^62^[REPLACE] if  ( position != null )  {^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "device", device )  ;^42^^^^^35^62^[REPLACE] velocityContext.put ( "position", position ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^43^^^^^35^62^[ADD] velocityContext.put ( "speedUnits", ReportUtils.getSpeedUnit ( userId )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^if  ( event.getGeofenceId (  )   ==  0 )  {^45^^^^^35^62^[REPLACE] if  ( event.getGeofenceId (  )  != 0 )  {^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^45^46^47^^^35^62^[ADD] if  ( event.getGeofenceId (  )  != 0 )  { velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ; }^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ;^46^^^^^35^62^[REPLACE] velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event .getDeviceId (  )   )  ) ;^46^^^^^35^62^[REPLACE] velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "geofence", Context.getIdentityManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ;^46^^^^^35^62^[REPLACE] velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getDeviceId (  )  )  ) ;^46^^^^^35^62^[REPLACE] velocityContext.put ( "geofence", Context.getGeofenceManager (  ) .getGeofence ( event.getGeofenceId (  )  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^velocityContext.put ( "webUrl", Context.getVelocityEngine (  ) .getTemplate ( "web.url" )  ) ;^48^^^^^35^62^[REPLACE] velocityContext.put ( "webUrl", Context.getVelocityEngine (  ) .getProperty ( "web.url" )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^48^^^^^35^62^[ADD] velocityContext.put ( "webUrl", Context.getVelocityEngine (  ) .getProperty ( "web.url" )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^getIdentityManager (  )  ;^48^^^^^35^62^[REPLACE] velocityContext.put ( "webUrl", Context.getVelocityEngine (  ) .getProperty ( "web.url" )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^Template template = this;^50^^^^^35^62^[REPLACE] Template template = null;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^template = Context.getVelocityEngine (  ) .getTemplate ( event.getType (  )  + ".vm" ) ;Log.warning ( error ) ;template = Context.getVelocityEngine (  ) .getTemplate ( "unknown.vm" ) ;^51^52^53^54^55^35^62^[ADD] try { template = Context.getVelocityEngine (  ) .getTemplate ( event.getType (  )  + ".vm" ) ; } catch  ( ResourceNotFoundException error )  { Log.warning ( error ) ; template = Context.getVelocityEngine (  ) .getTemplate ( "unknown.vm" ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^template = Context.getVelocityEngine (  ) .getTemplate ( event.getType (  )   ".vm" ) ;^52^^^^^35^62^[REPLACE] template = Context.getVelocityEngine (  ) .getTemplate ( event.getType (  )  + ".vm" ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^52^^^^^35^62^[ADD] template = Context.getVelocityEngine (  ) .getTemplate ( event.getType (  )  + ".vm" ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^template = getVelocityEngine (  ) .getTemplate (  (  ( event.getType (  )  )  + ".vm" )  )  ;^55^^^^^35^62^[REPLACE] template = Context.getVelocityEngine (  ) .getTemplate ( "unknown.vm" ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[ADD]^^58^^^^^35^62^[ADD] StringWriter writer = new StringWriter (  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^String subject =  ( String )  velocityContext.VelocityContext ( "subject" ) ;^60^^^^^35^62^[REPLACE] String subject =  ( String )  velocityContext.get ( "subject" ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
[REPLACE]^return new MailMessage ( subject, writer .StringWriter (  )   ) ;^61^^^^^35^62^[REPLACE] return new MailMessage ( subject, writer.toString (  )  ) ;^[METHOD] formatMessage [TYPE] MailMessage [PARAMETER] long userId Event event Position position [CLASS] NotificationFormatter   [TYPE]  boolean false  true  [TYPE]  StringWriter writer  [TYPE]  Position position  [TYPE]  Device device  [TYPE]  VelocityContext velocityContext  [TYPE]  Event event  [TYPE]  String subject  [TYPE]  ResourceNotFoundException error  [TYPE]  long userId  [TYPE]  Template template 
