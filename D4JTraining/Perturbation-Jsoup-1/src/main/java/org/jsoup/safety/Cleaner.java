[REPLACE]^whitelist   ;^29^^^^^28^31^[REPLACE] Validate.notNull ( whitelist ) ;^[METHOD] <init> [TYPE] Whitelist) [PARAMETER] Whitelist whitelist [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^this.whitelist =  null;^30^^^^^28^31^[REPLACE] this.whitelist = whitelist;^[METHOD] <init> [TYPE] Whitelist) [PARAMETER] Whitelist whitelist [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^this.el =  null;^124^^^^^123^126^[REPLACE] this.el = el;^[METHOD] <init> [TYPE] Element,int) [PARAMETER] Element el int numAttribsDiscarded [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[ADD]^^124^125^^^^123^126^[ADD] this.el = el; this.numAttribsDiscarded = numAttribsDiscarded;^[METHOD] <init> [TYPE] Element,int) [PARAMETER] Element el int numAttribsDiscarded [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^this.numAttribsDiscarded =  null;^125^^^^^123^126^[REPLACE] this.numAttribsDiscarded = numAttribsDiscarded;^[METHOD] <init> [TYPE] Element,int) [PARAMETER] Element el int numAttribsDiscarded [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^Validate.notNull ( clean ) ;^40^^^^^39^46^[REPLACE] Validate.notNull ( dirtyDocument ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[ADD]^^40^^^^^39^46^[ADD] Validate.notNull ( dirtyDocument ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^Document clean = Document.createShell ( dirtyDocument .createShell (  )   ) ;^42^^^^^39^46^[REPLACE] Document clean = Document.createShell ( dirtyDocument.baseUri (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[ADD]^^42^43^^^^39^46^[ADD] Document clean = Document.createShell ( dirtyDocument.baseUri (  )  ) ; copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^copySafeNodes ( dirtyDocument.baseUri (  ) , clean.body (  )  ) ;^43^^^^^39^46^[REPLACE] copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^copySafeNodes ( clean.body (  ) , clean.body (  )  ) ;^43^^^^^39^46^[REPLACE] copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[ADD]^^43^^^^^39^46^[ADD] copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^copySafeNodes ( dirtyDocument .baseUri (  )  , dirtyDocument^43^^^^^39^46^[REPLACE] copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^return dirtyDocument;^45^^^^^39^46^[REPLACE] return clean;^[METHOD] clean [TYPE] Document [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  [TYPE]  Element el 
[REPLACE]^Validate.notNull ( clean ) ;^59^^^^^58^64^[REPLACE] Validate.notNull ( dirtyDocument ) ;^[METHOD] isValid [TYPE] boolean [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  numDiscarded  [TYPE]  Element el 
[REPLACE]^Document clean = Document.createShell ( dirtyDocument .createShell (  )   ) ;^61^^^^^58^64^[REPLACE] Document clean = Document.createShell ( dirtyDocument.baseUri (  )  ) ;^[METHOD] isValid [TYPE] boolean [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  numDiscarded  [TYPE]  Element el 
[REPLACE]^TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^62^^^^^58^64^[REPLACE] int numDiscarded = copySafeNodes ( dirtyDocument.body (  ) , clean.body (  )  ) ;^[METHOD] isValid [TYPE] boolean [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  numDiscarded  [TYPE]  Element el 
[REPLACE]^return numDiscarded  !=  1;;^63^^^^^58^64^[REPLACE] return numDiscarded == 0;^[METHOD] isValid [TYPE] boolean [PARAMETER] Document dirtyDocument [CLASS] Cleaner ElementMeta   [TYPE]  Whitelist whitelist  [TYPE]  boolean false  true  [TYPE]  Document clean  dirtyDocument  [TYPE]  int numAttribsDiscarded  numDiscarded  [TYPE]  Element el 
[REPLACE]^List<Node> sourceElChildren = source .tagName (  )  ;^73^^^^^72^98^[REPLACE] List<Node> sourceChildren = source.childNodes (  ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^int numDiscarded = 4;^74^^^^^72^98^[REPLACE] int numDiscarded = 0;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^if  ( ! sourceChild instanceof Element )  {^77^^^^^72^98^[REPLACE] if  ( sourceChild instanceof Element )  {^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^}  if  ( ! sourceChild instanceof TextNode )  {^91^^^^^72^98^[REPLACE] } else if  ( sourceChild instanceof TextNode )  {^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^for  ( Node sourceChild : sourceChildren )  { if  ( sourceChild instanceof Element )  {^92^^^^^72^98^[REPLACE] TextNode sourceText =  ( TextNode )  sourceChild;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^92^93^^^^72^98^[ADD] TextNode sourceText =  ( TextNode )  sourceChild; TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^TextNode destText = new TextNode ( destText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^93^^^^^72^98^[REPLACE] TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^if  ( whitelist.isSafeTag ( source.tagName (  )  )  )  {^80^^^^^72^98^[REPLACE] if  ( whitelist.isSafeTag ( sourceEl.tagName (  )  )  )  {^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^80^81^82^83^^72^98^[ADD] if  ( whitelist.isSafeTag ( sourceEl.tagName (  )  )  )  { ElementMeta meta = createSafeElement ( sourceEl ) ; Element destChild = meta.el; dest.appendChild ( destChild ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^numDiscarded += copySafeNodes ( sourceEl, destChild ) ; ;^89^^^^^80^90^[REPLACE] numDiscarded += copySafeNodes ( sourceEl, dest ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^numDiscarded +=  null.numAttribsDiscarded;^85^^^^^72^98^[REPLACE] numDiscarded += meta.numAttribsDiscarded;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^numDiscarded += copySafeNodes ( sourceEl, dest ) ; ;^86^^^^^72^98^[REPLACE] numDiscarded += copySafeNodes ( sourceEl, destChild ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^86^^^^^72^98^[ADD] numDiscarded += copySafeNodes ( sourceEl, destChild ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^ElementMeta meta = createSafeElement ( el ) ;^81^^^^^72^98^[REPLACE] ElementMeta meta = createSafeElement ( sourceEl ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^Element sourceEl =  ( Element )  sourceChild;^82^^^^^72^98^[REPLACE] Element destChild = meta.el;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^82^83^^^^72^98^[ADD] Element destChild = meta.el; dest.appendChild ( destChild ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^numDiscarded += copySafeNodes ( sourceEl, destChild ) ; ;^89^^^^^72^98^[REPLACE] numDiscarded += copySafeNodes ( sourceEl, dest ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^TextNode sourceText =  ( TextNode )  sourceChild;^78^^^^^72^98^[REPLACE] Element sourceEl =  ( Element )  sourceChild;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^78^^^^^72^98^[ADD] Element sourceEl =  ( Element )  sourceChild;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^85^^^^^72^98^[ADD] numDiscarded += meta.numAttribsDiscarded;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^}  else {^91^^^^^72^98^[REPLACE] } else if  ( sourceChild instanceof TextNode )  {^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild .createShell (  )   ) ;^93^^^^^72^98^[REPLACE] TextNode destText = new TextNode ( sourceText.getWholeText (  ) , sourceChild.baseUri (  )  ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^String sourceTag = sourceEl.tagName (  ) ;^76^^^^^72^98^[REPLACE] for  ( Node sourceChild : sourceChildren )  {^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^ElementMeta meta = createSafeElement ( source ) ;^81^^^^^72^98^[REPLACE] ElementMeta meta = createSafeElement ( sourceEl ) ;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^return numAttribsDiscarded;^97^^^^^72^98^[REPLACE] return numDiscarded;^[METHOD] copySafeNodes [TYPE] int [PARAMETER] Element source Element dest [CLASS] Cleaner ElementMeta   [TYPE]  ElementMeta meta  [TYPE]  boolean false  true  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Node sourceChild  [TYPE]  Whitelist whitelist  [TYPE]  List sourceChildren  [TYPE]  TextNode destText  sourceText  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^String sourceTag = source.tagName (  ) ;^101^^^^^100^117^[REPLACE] String sourceTag = sourceEl.tagName (  ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^Attributes enforcedAttrs = whitelist.getEnforcedAttributes ( sourceTag ) ;^102^^^^^100^117^[REPLACE] Attributes destAttrs = new Attributes (  ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^Element dest = new Element ( Tag.valueOf ( sourceTag ) , sourceEl.baseUri (  ) , sourceAttrs ) ;^103^^^^^100^117^[REPLACE] Element dest = new Element ( Tag.valueOf ( sourceTag ) , sourceEl.baseUri (  ) , destAttrs ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^int numDiscarded = 3;^104^^^^^100^117^[REPLACE] int numDiscarded = 0;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^Attributes sourceAttrs = sourceEl .childNodes (  )  ;^106^^^^^100^117^[REPLACE] Attributes sourceAttrs = sourceEl.attributes (  ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^if  ( whitelist.isSafeAttribute ( sourceTag, source, sourceAttr )  ) destAttrs.put ( sourceAttr ) ;^108^109^^^^100^117^[REPLACE] if  ( whitelist.isSafeAttribute ( sourceTag, sourceEl, sourceAttr )  ) destAttrs.put ( sourceAttr ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^destAttrs.put ( sourceAttr ) ;numDiscarded++;^108^109^110^111^112^100^117^[ADD] if  ( whitelist.isSafeAttribute ( sourceTag, sourceEl, sourceAttr )  ) destAttrs.put ( sourceAttr ) ; else numDiscarded++; }^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^destAttrs.addAll ( sourceAttr ) ;^109^^^^^100^117^[REPLACE] destAttrs.put ( sourceAttr ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[ADD]^^109^^^^^100^117^[ADD] destAttrs.put ( sourceAttr ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^for  ( Node sourceChild : sourceChildren )  { if  ( sourceChild instanceof Element )  {^107^^^^^100^117^[REPLACE] for  ( Attribute sourceAttr : sourceAttrs )  {^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^Attributes enforcedAttrs = whitelist .isSafeAttribute ( sourceTag , source , sourceAttr )  ;^113^^^^^100^117^[REPLACE] Attributes enforcedAttrs = whitelist.getEnforcedAttributes ( sourceTag ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^destAttrs.addAll ( sourceAttrs ) ;^114^^^^^100^117^[REPLACE] destAttrs.addAll ( enforcedAttrs ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^return new ElementMeta ( sourceEl, numDiscarded ) ;^116^^^^^100^117^[REPLACE] return new ElementMeta ( dest, numDiscarded ) ;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] Cleaner ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^long  numAttribsDiscarded;^121^^^^^^^[REPLACE] int numAttribsDiscarded;^[METHOD] createSafeElement [TYPE] Cleaner$ElementMeta [PARAMETER] Element sourceEl [CLASS] ElementMeta   [TYPE]  boolean false  true  [TYPE]  Attribute sourceAttr  [TYPE]  Element dest  destChild  el  source  sourceEl  [TYPE]  Attributes destAttrs  enforcedAttrs  sourceAttrs  [TYPE]  Whitelist whitelist  [TYPE]  String sourceTag  [TYPE]  int numAttribsDiscarded  numDiscarded 
[REPLACE]^this.el =  null;^124^^^^^123^126^[REPLACE] this.el = el;^[METHOD] <init> [TYPE] Element,int) [PARAMETER] Element el int numAttribsDiscarded [CLASS] ElementMeta   [TYPE]  int numAttribsDiscarded  [TYPE]  Element el  [TYPE]  boolean false  true 
[REPLACE]^this.numAttribsDiscarded =  null;^125^^^^^123^126^[REPLACE] this.numAttribsDiscarded = numAttribsDiscarded;^[METHOD] <init> [TYPE] Element,int) [PARAMETER] Element el int numAttribsDiscarded [CLASS] ElementMeta   [TYPE]  int numAttribsDiscarded  [TYPE]  Element el  [TYPE]  boolean false  true 
